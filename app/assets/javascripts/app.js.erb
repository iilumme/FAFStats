var FAFStats = angular.module('FAFStats', ['ngRoute', 'validation.match'])
    .run(function($rootScope, StatsApi, FAFApi) {
      /* RootScope Variables */
      $rootScope.players = new Array();
      $rootScope.user = null;

      StatsApi.getUserInSession().success(function(user){
        $rootScope.user = user;
      });

      $rootScope.triggerSearch = function() {
        if ($('.player-search').val().length < 3 && $rootScope.players.length > 0) {
          $rootScope.players = new Array();
        } else if ($('.player-search').val().length >= 3 && $rootScope.players.length <= 0) {
          FAFApi.searchForPlayersByName($('.player-search').val()).success(function(players) {
            $rootScope.players = players.data;
          });
        }
      };

      $rootScope.focusPlayerSearch = function() {
        $('.search-suggest').css('display', 'inline-block');
      };

      $rootScope.blurPlayerSearch = function() {
        $('.search-suggest').css('display', 'none');
        $("#search").val("");
        $rootScope.players = new Array();
      };

    })
    .config(function ($routeProvider, $locationProvider) {
//        $locationProvider.html5Mode(true);
      $routeProvider
          .when('/', {
            controller: 'RootController',
            templateUrl: '<%= asset_path("static/root.html") %> '
          })
          .when('/playertemplate', {
            controller: 'PlayerController',
            templateUrl: '<%= asset_path("dynamic/player_show.html") %> '
          })
          .when('/player/:id', {
            controller: 'PlayerController',
            templateUrl: '<%= asset_path("dynamic/player_show.html") %> '
          })
          .when('/leaderboards', {
            controller: 'LeaderboardsController',
            templateUrl: '<%= asset_path("dynamic/leaderboards_show.html") %> '
          })
          .when('/games', {
            controller: 'GameIndexController',
            templateUrl: '<%= asset_path("dynamic/game_index.html") %> '
          })
          .when('/game/:id', {
            controller: 'GameController',
            templateUrl: '<%= asset_path("dynamic/game_show.html") %> '
          })
          .when('/login', {
            controller: 'LogInController',
            templateUrl: '<%= asset_path("dynamic/login.html") %> '
          });
    });
