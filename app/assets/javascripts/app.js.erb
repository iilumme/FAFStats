var FAFStats = angular.module('FAFStats', ['ngRoute'])
    .run(function($rootScope, StatsApi, FAFApi) {
      StatsApi.getSession().success(function(user){
        $rootScope.user = user;
      });

      $rootScope.renderAllPlayers = function() {
        if ($('.player-search').val().length === 3) {
          FAFApi.getAllPlayers().success(function(players) {
            $rootScope.players = players.data;
          });
        }
      };

      $rootScope.visibleSuggestions = function() {
        $('.search-suggest').css('display', 'block');
      };

      $rootScope.invisibleSuggestions = function() {
        $('.search-suggest').css('display', 'none');
      };

    })
    .config(function ($routeProvider, $locationProvider) {
//        $locationProvider.html5Mode(true);
      $routeProvider
          .when('/', {
            controller: 'RootController',
            templateUrl: '<%= asset_path("static/root.html") %> '
          })
          .when('/playertemplate', {
            controller: 'PlayerController',
            templateUrl: '<%= asset_path("dynamic/player_show.html") %> '
          })
          .when('/player/:id', {
            controller: 'PlayerController',
            templateUrl: '<%= asset_path("dynamic/player_show.html") %> '
          })
          .when('/leaderboards', {
            controller: 'LeaderboardsController',
            templateUrl: '<%= asset_path("dynamic/leaderboards_show.html") %> '
          })
          .when('/games', {
            controller: 'GameIndexController',
            templateUrl: '<%= asset_path("dynamic/game_index.html") %> '
          })
          .when('/game/:id', {
            controller: 'GameController',
            templateUrl: '<%= asset_path("dynamic/game_show.html") %> '
          });
    });
